# Генеративная Обратная Проекция в CPSF

## Цель

Построить строго аналитическую процедуру, которая по заданной семантической цели $T^* \in \mathbb{C}^S$:

1. Находит приближённую область возбуждения $(z^*, \vec{d}^*)$;
2. Уточняет её через семантико-геометрическое взвешивание $(z^{**}, \vec{d}^{**})$;
3. Проверяет локальную ошибку: $\|T(z^{**}, \vec{d}^{**}) - T^*\|$;
4. Если ошибка превышает $\delta$, выполняет **аналитическое генеративное возбуждение** — создание вкладов, вызывающих $T^*$ в данной области;
5. Обеспечивает инвариантность последующих вызовов проекции по $T^*$.

---

## Обозначения

* $T^* \in \mathbb{C}^S$, $\|T^*\| = 1$ — целевая семантика;
* $T(z, \vec{d}) := \sum\limits_j \alpha_j \cdot \psi_j^{\mathbb{T}}(z, \vec{d}) \cdot \hat{T}_j$ — поле CPSF;
* $C_j := (z_j, \vec{d}_j, \hat{T}_j, \alpha_j, \Sigma_j)$ — вклад;
* $\psi_j^{\mathbb{T}}(z, \vec{d})$ — периодизированная гауссова оболочка, $C^\infty$-гладкая по всем аргументам.

---

## Шаг 1. Грубая обратная проекция (Semantic Inverse Projection)

Определяется начальная локализация по текущим вкладам:

1. **Направление:**

$$
\vec{d}^* := \frac{ \sum\limits_j \alpha_j \langle \hat{T}_j, T^* \rangle \vec{d}_j }{ \left\| \sum\limits_j \alpha_j \langle \hat{T}_j, T^* \rangle \vec{d}_j \right\| }
$$

2. **Положение:**

$$
\Psi(z) := \sum\limits_j |\alpha_j|^2 |\langle \hat{T}_j, T^* \rangle|^2 \cdot \psi_j^{\mathbb{T}}(z, \vec{d}^*)
$$

$$
\tilde{z}^* := \frac{ \int\limits_{\mathbb{T}_\mathbb{C}^N} \Psi(z) \cdot \tilde{z} \, d\mu(z) }{ \int\limits_{\mathbb{T}_\mathbb{C}^N} \Psi(z) \, d\mu(z) }
$$

---

## Шаг 2. Уточнение (Refined Attraction-Repulsion)

### 2.1 Весовые коэффициенты:

$$
\lambda_j := \beta \cdot \Re \langle \hat{T}_j, T^* \rangle, \quad
w_j := e^{\lambda_j} \cdot \psi_j^{\mathbb{T}}(z^*, \vec{d}^*)
$$

### 2.2 Уточнённое направление и локализация:

$$
\vec{d}^{**} := \frac{ \sum\limits_j w_j \vec{d}_j }{ \left\| \sum\limits_j w_j \vec{d}_j \right\| }, \quad
z^{**} := \frac{ \sum\limits_j w_j z_j }{ \sum\limits_j w_j }
$$

---

## Шаг 3. Проверка локальной ошибки

Рассматривается локальное значение поля:

$$
T(z^{**}, \vec{d}^{**}) = \sum\limits_j \alpha_j \cdot \psi_j^{\mathbb{T}}(z^{**}, \vec{d}^{**}) \cdot \hat{T}_j
$$

Если:

$$
\| T(z^{**}, \vec{d}^{**}) - T^* \| < \delta
$$

→ завершение. Иначе — переход к генеративной проекции.

---

## Шаг 4. Генеративное возбуждение (Analytic Generative Recall)

Построение новых вкладов $C_k^{\text{gen}}$ по центру $(z^{**}, \vec{d}^{**})$:

1. $n$ равномерных точек $z_k$ и направлений $\vec{d}_k$ в малой окрестности;
2. Параметры затухания $\sigma_k^{\parallel}, \sigma_k^{\perp}$;
3. Направление: $\hat{T}_k := T^*/\|T^*\|$;
4. Амплитуды:

$$
\alpha_k := \frac{\|T^*\|}{\sum\limits_{j=1}^n \psi_j^{\mathbb{T}}(z^{**}, \vec{d}^{**})}
$$

5. Каждое $C_k^{\text{gen}} := (z_k, \vec{d}_k, \hat{T}_k, \alpha_k, \Sigma_k)$

---

## Инвариантность

После генерации:

* Все новые вкладки локализованы и когерентны с $T^*$;
* При повторном применении Inverse Projection по $T^*$ центр тяжести сместится обратно к $(z^{**}, \vec{d}^{**})$;
* Если ошибка осталась выше $\delta$, алгоритм повторяется.

---

## Теорема (локальная семантическая инвариантность)

Пусть поле $T$ допускает генерацию вкладов в окрестности $(z^{**}, \vec{d}^{**})$ так, что:

$$
\sup\limits_{(z, \vec{d}) \in U} \| T(z, \vec{d}) - T^* \| < \delta
$$

Тогда повторный вызов проекции по $T^*$ вернёт локализацию:

$$
(z', \vec{d}') \in U, \quad \text{с } \|T(z', \vec{d}') - T^*\| < \delta
$$

при условии экспоненциального взвешивания по семантике и геометрии.

---

## Вывод

Алгоритм определяет строго аналитический цикл *Refined Semantic Projection + Generative Recall*,
который:

* стабилен,
* локализован,
* семантически согласован,
* и при завершении гарантирует инвариантность последующих извлечений по $T^*$.

Является фундаментом операции **Generative Semantic Memory Recall** в CPSF.
